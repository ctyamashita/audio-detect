/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/decibel-meter@2.0.0/dist/decibel-meter.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var e={exports:{}},n=e.exports=function(){return function(e){var n={};function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=3)}([function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=s(t(5)),o=s(t(2)),c=s(t(1)),u=t(4);function s(e){return e&&e.__esModule?e:{default:e}}var a=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,i.default)();!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.id=n,this.listening=!1,this.events=new o.default(this),this._connection=null,(0,u.register)(this)}return r(e,[{key:"on",value:function(e,n){return this.events.on(e,n),n}},{key:"off",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.events.off(e,n),n}},{key:"listen",value:function(){return this.listening||(this.listening=!0,this.events.dispatch("change",this.listening),this.connection&&this.connection.dBAnalyser.start()),this}},{key:"stopListening",value:function(){return this.listening&&(this.connection&&this.connection.dBAnalyser.stop(),this.listening=!1,this.events.dispatch("change",this.listening)),this}},{key:"listenTo",value:function(e,n){var t=this;return this.connectTo(e).then((function(e){return t.events.on("sample",n),e.listen(),t}))}},{key:"connect",value:function(e){var n=this;if(e instanceof MediaDeviceInfo){if(this._connection&&this._connection.source===e)return Promise.resolve(this);var t={audio:{mandatory:{sourceId:e.deviceId}}};return navigator.mediaDevices.getUserMedia(t).then((function(t){var r=null,i=void 0;if(n._connection){r=n._connection.source;var o=n._connection.source,u=n._connection.stream,s=u.getAudioTracks().find((function(e){return e.label===o.label}));s&&(s.stop(),u.removeTrack(s)),n._connection.dBAnalyser.stop(),n._connection.streamSource.disconnect(),delete n._connection.stream,delete n._connection.streamSource,(i=n._connection).source=e,i.stream=t,i.streamSource=i.context.createMediaStreamSource(t),i.streamSource.connect(i.analyser)}else(i={stream:t,source:e,context:new AudioContext}).analyser=i.context.createAnalyser(),i.analyser.smoothingTimeConstant=.5,i.lastSample=new Uint8Array(1),i.streamSource=i.context.createMediaStreamSource(t),i.streamSource.connect(i.analyser),i.dBAnalyser=new c.default(n),n._connection=i;return n.events.dispatch("connect",e,r),n.listening&&!i.dBAnalyser.running&&i.dBAnalyser.start(),n}))}return Promise.reject(new TypeError("DecibelMeter: Expected first parameter to be of type MediaDeviceInfo"))}},{key:"connectTo",value:function(e){var n=this;return this.sources.then((function(t){if(0===t.length)throw new ReferenceError("DecibelMeter: No audioinput sources available");if("number"==typeof e)return t[e]?n.connect(t[e]):Promise.reject(new ReferenceError("DecibelMeter: Source not found INDEX "+e));if("string"==typeof e){var r=t.find((function(n){return n.deviceId===e}));return r?n.connect(r):Promise.reject(new ReferenceError("DecibelMeter: Source not found DEVICEID "+e))}return Promise.reject(new TypeError("DecibelMeter: Invalid source identifier"))}))}},{key:"disconnect",value:function(){var e=this;return this.stopListening(),this.connection&&(this.connection.dBAnalyser.stop(),this.connection.streamSource.disconnect(),this.connection.stream.getAudioTracks().forEach((function(e){return e.stop()}))),new Promise((function(n){setTimeout((function(){delete e._connection.stream,delete e._connection.streamSource,e._connection=null,e.events.dispatch("disconnect"),n(e)}),100)}))}},{key:"source",get:function(){return this._connection&&this._connection.source?this._connection.source:null}},{key:"connection",get:function(){return this._connection}},{key:"sources",get:function(){return navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices?navigator.mediaDevices.enumerateDevices().then((function(e){return e.filter((function(e){return"audioinput"===e.kind}))})):Promise.reject(new Error("MediaDevices.enumerateDevices() is not supported"))}},{key:"connected",get:function(){return null!==this._connection}}],[{key:"getMeterById",value:function(e){return(0,u.getById)(e)}},{key:"meters",get:function(){return(0,u.registry)()}}]),e}();n.default=a,e.exports=n.default},function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.meter=n,this._running=!1}return r(e,[{key:"running",get:function(){return this._running}}]),r(e,[{key:"update",value:function(){var e=this,n=this.meter.connection,t=n.analyser,r=n.lastSample;t.getByteFrequencyData(r);var i=r[0],o=i/255,c=t.minDecibels+(t.maxDecibels-t.minDecibels)*o;this.meter.events.dispatch("sample",c,i,o,t.minDecibels,t.maxDecibels),this._running&&requestAnimationFrame((function(){return e.update()}))}},{key:"start",value:function(){this._running=!0,this.update()}},{key:"stop",value:function(){this._running=!1}}]),e}();n.default=i,e.exports=n.default},function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),i=function(){function e(n){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this.context=n,this.eventIndex={}}return r(e,[{key:"index",value:function(e){return this.eventIndex[e]?this.eventIndex[e]:this.eventIndex[e]=[]}},{key:"on",value:function(e,n){this.index(e).push(n)}},{key:"off",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null===e)return this.eventIndex={};var t=this.index(e);if(null===n)return t.splice(0);t.includes(n)&&t.splice(t.indexOf(n),1)}},{key:"dispatch",value:function(e){for(var n=this,t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];this.index(e).forEach((function(e){return e.apply(n.context,r)}))}}]),e}();n.default=i,e.exports=n.default},function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0});var r=t(0);Object.defineProperty(n,"default",{enumerable:!0,get:function(){return(e=r,e&&e.__esModule?e:{default:e}).default;var e}}),e.exports=n.default},function(e,n,t){function r(){return void 0===navigator.__decibelMeters&&(navigator.__decibelMeters={}),navigator.__decibelMeters}Object.defineProperty(n,"__esModule",{value:!0}),n.registry=r,n.register=function(e){return r()[e.id]=e},n.getById=function(e){return r()[e]||null}},function(e,n,t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){var e=performance.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(n){var t=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==n?t:3&t|8).toString(16)}))},e.exports=n.default}])}();export{n as default};
//# sourceMappingURL=/sm/cb8c2a23cf074b659cb3fd99eaffd0654db6c1a3c78aca59cd4b77d0b6227504.map